<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Word Defenders - Retro Games Collection</title>
<link rel="stylesheet" href="../../core/base.css">
<link rel="stylesheet" href="../../core/components.css">
<link rel="stylesheet" href="../../core/responsive.css">
</head>
<body>
<!-- Enhanced Navigation will be automatically inserted here -->
<script type="module">
import { EnhancedNavigation } from '../../core/navigation.js';
import { GameContainer } from '../../components/GameContainer.js';
import { GAME_CONFIGS } from '../../config/games.js';

// Initialize enhanced navigation
const navigation = new EnhancedNavigation();

// Initialize game container with word-defenders config
const gameConfig = GAME_CONFIGS['word-defenders'];
const gameContainer = new GameContainer(gameConfig);

// Initialize the container
gameContainer.init();

// Get the canvas from the container
const canvas = gameContainer.getCanvas();
const ctx = canvas.getContext('2d');

// Game variables
let score = 0;
let lives = 3;
let gameRunning = true;
let gameOver = false;
let level = 1;
let words = [];
let playerInput = '';
let currentWord = '';
let wordTimer = 0;
let wordDuration = 5000; // 5 seconds per word

// Word lists for different difficulty levels
const WORD_LISTS = {
    easy: ['cat', 'dog', 'hat', 'run', 'jump', 'play', 'book', 'tree', 'house', 'car'],
    medium: ['computer', 'elephant', 'beautiful', 'adventure', 'knowledge', 'happiness', 'butterfly', 'mountain', 'ocean', 'universe'],
    hard: ['extraterrestrial', 'philosophical', 'revolutionary', 'technological', 'extraordinary', 'sophisticated', 'revolutionary', 'technological', 'extraordinary', 'sophisticated']
};

// Initialize game
function initGame() {
    score = 0;
    lives = 3;
    level = 1;
    gameOver = false;
    gameRunning = true;
    gameContainer.updateScore(score);
    gameContainer.updateLives(lives);
    words = [];
    playerInput = '';
    spawnNewWord();
}

// Spawn a new word
function spawnNewWord() {
    const difficulty = level <= 3 ? 'easy' : level <= 6 ? 'medium' : 'hard';
    const wordList = WORD_LISTS[difficulty];
    currentWord = wordList[Math.floor(Math.random() * wordList.length)];
    wordTimer = 0;
    
    // Position word randomly across the screen
    const wordObj = {
        text: currentWord,
        x: Math.random() * (canvas.width - 200) + 100,
        y: 50,
        speed: 1 + Math.random() * 2,
        color: `hsl(${Math.random() * 360}, 70%, 60%)`
    };
    
    words.push(wordObj);
}

// Update game state
function update(deltaTime) {
    if (!gameRunning || gameOver) return;
    
    // Update word timers
    wordTimer += deltaTime;
    
    // Move words down
    words.forEach((word, index) => {
        word.y += word.speed;
        
        // Remove words that reach the bottom
        if (word.y > canvas.height) {
            words.splice(index, 1);
            lives--;
            gameContainer.updateLives(lives);
            
            if (lives <= 0) {
                gameOver = true;
                gameRunning = false;
            }
        }
    });
    
    // Spawn new word if needed
    if (words.length === 0 || wordTimer > wordDuration) {
        spawnNewWord();
    }
    
    // Check win condition
    if (score >= level * 100) {
        level++;
        words = [];
        spawnNewWord();
    }
}

// Draw functions
function drawWords() {
    words.forEach(word => {
        ctx.fillStyle = word.color;
        ctx.font = '24px monospace';
        ctx.textAlign = 'center';
        ctx.fillText(word.text, word.x, word.y);
        
        // Draw word border
        ctx.strokeStyle = '#fff';
        ctx.lineWidth = 2;
        ctx.strokeText(word.text, word.x, word.y);
    });
}

function drawPlayerInput() {
    if (playerInput) {
        ctx.fillStyle = '#0f0';
        ctx.font = '32px monospace';
        ctx.textAlign = 'center';
        ctx.fillText(playerInput, canvas.width / 2, canvas.height - 100);
        
        // Draw cursor
        ctx.fillStyle = '#fff';
        ctx.fillRect(canvas.width / 2 + ctx.measureText(playerInput).width / 2, canvas.height - 120, 2, 30);
    }
}

function drawUI() {
    ctx.fillStyle = '#fff';
    ctx.font = '20px monospace';
    ctx.textAlign = 'left';
    ctx.fillText(`Score: ${score}`, 20, 30);
    ctx.fillText(`Lives: ${lives}`, 20, 60);
    ctx.fillText(`Level: ${level}`, 20, 90);
    ctx.fillText(`Current Word: ${currentWord}`, 20, 120);
}

function drawGameOver() {
    ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    ctx.fillStyle = '#f00';
    ctx.font = '48px monospace';
    ctx.textAlign = 'center';
    ctx.fillText('GAME OVER', canvas.width / 2, canvas.height / 2 - 50);
    
    ctx.fillStyle = '#fff';
    ctx.font = '24px monospace';
    ctx.fillText(`Final Score: ${score}`, canvas.width / 2, canvas.height / 2);
    ctx.fillText('Press R to restart', canvas.width / 2, canvas.height / 2 + 50);
}

// Game loop
let lastTime = 0;
function gameLoop(currentTime) {
    const deltaTime = currentTime - lastTime;
    lastTime = currentTime;
    
    // Clear canvas
    ctx.fillStyle = '#000';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Update game state
    update(deltaTime);
    
    // Draw game elements
    drawWords();
    drawPlayerInput();
    drawUI();
    
    if (gameOver) {
        drawGameOver();
        return;
    }
    
    requestAnimationFrame(gameLoop);
}

// Event listeners
gameContainer.on('keydown', (e) => {
    if (gameOver) {
        if (e.key === 'r' || e.key === 'R') {
            restartGame();
        }
        return;
    }
    
    if (e.key === 'Enter') {
        // Check if input matches current word
        if (playerInput.toLowerCase() === currentWord.toLowerCase()) {
            score += 50;
            gameContainer.updateScore(score);
            
            // Remove the word
            words = words.filter(word => word.text !== currentWord);
            
            // Clear input
            playerInput = '';
            
            // Spawn new word
            spawnNewWord();
        } else {
            // Wrong word - lose life
            lives--;
            gameContainer.updateLives(lives);
            playerInput = '';
            
            if (lives <= 0) {
                gameOver = true;
                gameRunning = false;
            }
        }
    } else if (e.key === 'Backspace') {
        playerInput = playerInput.slice(0, -1);
    } else if (e.key === 'Escape') {
        playerInput = '';
    } else if (e.key.length === 1 && /[a-zA-Z]/.test(e.key)) {
        playerInput += e.key;
    } else if (e.key === ' ') {
        gameRunning = !gameRunning;
        if (gameRunning) gameLoop();
    }
});

// Touch controls for mobile
let touchStartX = 0;
let touchStartY = 0;

canvas.addEventListener('touchstart', (e) => {
    e.preventDefault();
    const touch = e.touches[0];
    const rect = canvas.getBoundingClientRect();
    touchStartX = touch.clientX - rect.left;
    touchStartY = touch.clientY - rect.top;
});

canvas.addEventListener('touchend', (e) => {
    e.preventDefault();
    const touch = e.changedTouches[0];
    const rect = canvas.getBoundingClientRect();
    const touchX = touch.clientX - rect.left;
    const touchY = touch.clientY - rect.top;
    
    const deltaX = touchX - touchStartX;
    const deltaY = touchY - touchStartY;
    
    // Simple touch controls - tap to pause/resume
    if (Math.abs(deltaX) < 10 && Math.abs(deltaY) < 10) {
        gameRunning = !gameRunning;
        if (gameRunning) gameLoop();
    }
});

function restartGame() {
    initGame();
    gameLoop();
}

// Initialize game
initGame();
gameLoop();

// Update game container with game instance
gameContainer.gameInstance = {
    pause: () => { gameRunning = false; },
    resume: () => { gameRunning = true; gameLoop(); },
    restart: restartGame
};

console.log('Word Defenders game initialized with universal system');
</script>
</body>
</html>
